# データ分析プラットフォーム実装案

## 🎨 具体的なイメージ

### コンセプト
「ボートレースのデータを可視化・分析するツール」

**従来の予想サイト**:
```
レース一覧 → [AI予想を見る] → 本命: ◯号艇
```

**データ分析プラットフォーム**:
```
レース一覧 → [データ分析を見る] → 統計グラフ、トレンド、比較表
```

---

## 📊 画面イメージ（モックアップ）

### 1. トップページ（レース選択）
```
┌─────────────────────────────────────────────────┐
│ 🚤 ボートレースデータ分析プラットフォーム           │
├─────────────────────────────────────────────────┤
│ [今日のレース] [選手検索] [レース場分析] [統計]   │
├─────────────────────────────────────────────────┤
│                                                 │
│ 📅 本日のレース - 江戸川                         │
│                                                 │
│ ┌─────────────────────────────────────────┐    │
│ │ 1R  10:30  締切予定  [データ分析] ────→   │    │
│ └─────────────────────────────────────────┘    │
│ ┌─────────────────────────────────────────┐    │
│ │ 2R  11:00  締切予定  [データ分析] ────→   │    │
│ └─────────────────────────────────────────┘    │
│                                                 │
└─────────────────────────────────────────────────┘
```

### 2. データ分析ページ（レース選択後）
```
┌─────────────────────────────────────────────────────────────┐
│ 📊 データ分析 - 江戸川 1R                                    │
├─────────────────────────────────────────────────────────────┤
│                                                             │
│ ┌─────────────────┐  ┌─────────────────┐                  │
│ │  天候: 晴れ      │  │  風速: 3.2m     │                  │
│ │  気温: 18.5℃    │  │  波高: 2cm      │                  │
│ └─────────────────┘  └─────────────────┘                  │
│                                                             │
│ ━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━           │
│ 🏃 出走選手の統計分析                                        │
│ ━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━           │
│                                                             │
│ ┌─────────────────────────────────────────────────────┐   │
│ │ 艇番 │ 選手名   │ 勝率 │ 2連率 │ 今節成績 │ 比較 │   │
│ │──────┼─────────┼──────┼───────┼─────────┼──────│   │
│ │  1   │ 山田太郎 │ 6.82 │ 45.2% │ 2-1-3   │ 📊  │   │
│ │  2   │ 鈴木次郎 │ 5.43 │ 38.1% │ 3-4-2   │ 📊  │   │
│ │  3   │ 佐藤三郎 │ 7.12 │ 52.3% │ 1-1-1   │ 📊  │   │
│ └─────────────────────────────────────────────────────┘   │
│                                                             │
│ ━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━           │
│ 📈 選手別パフォーマンストレンド                              │
│ ━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━           │
│                                                             │
│   勝率                                                      │
│   8.0 ┤         ╭─ 3号艇（佐藤三郎）                       │
│   7.0 ┤    ╭────╯                                          │
│   6.0 ┤ ───╯         ─── 1号艇（山田太郎）                 │
│   5.0 ┤        ─────────── 2号艇（鈴木次郎）               │
│   4.0 ┤                                                    │
│       └────────────────────────────→                      │
│         10月    11月    12月                                │
│                                                             │
│ ━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━           │
│ 🔧 モーター・ボート分析                                      │
│ ━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━           │
│                                                             │
│ ┌─────────────────────────────────────────────────────┐   │
│ │ 艇番 │ モーター番号 │ モーター2連率 │ ボート番号 │      │
│ │──────┼──────────────┼───────────────┼────────────│      │
│ │  1   │   42         │   38.5%       │   12       │      │
│ │  2   │   15         │   45.2% 🔥   │   08       │      │
│ │  3   │   68         │   52.1% 🔥   │   23       │      │
│ └─────────────────────────────────────────────────────┘   │
│                                                             │
│ ━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━           │
│ 📌 統計的な注目ポイント                                      │
│ ━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━           │
│                                                             │
│ ✓ 3号艇の選手は当レース場での勝率が70%以上                  │
│ ✓ 2号艇のモーターは今節2連率が45%を超える好調機             │
│ ✓ 1号艇の選手は過去10走で平均着順2.3と安定                  │
│                                                             │
└─────────────────────────────────────────────────────────────┘
```

### 3. 選手詳細ページ
```
┌─────────────────────────────────────────────────┐
│ 👤 選手詳細分析 - 山田太郎                        │
├─────────────────────────────────────────────────┤
│                                                 │
│ 基本情報                                         │
│ ├ 級別: A1                                      │
│ ├ 年齢: 35歳                                     │
│ ├ 支部: 東京                                     │
│ └ 身長/体重: 165cm / 52kg                       │
│                                                 │
│ ━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━           │
│ 📊 成績推移（過去6ヶ月）                         │
│ ━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━           │
│                                                 │
│ [グラフ: 勝率の推移]                             │
│ [グラフ: 平均着順の推移]                         │
│                                                 │
│ ━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━           │
│ 🎯 レース場別成績                                │
│ ━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━           │
│                                                 │
│ 得意: 江戸川(勝率8.2) > 戸田(7.8) > 平和島(7.5) │
│ 苦手: 大村(4.2) < 徳山(4.8) < 下関(5.1)         │
│                                                 │
│ [ヒートマップで全24レース場を表示]               │
│                                                 │
└─────────────────────────────────────────────────┘
```

### 4. レース場分析ページ
```
┌─────────────────────────────────────────────────┐
│ 🏟️ レース場分析 - 江戸川                         │
├─────────────────────────────────────────────────┤
│                                                 │
│ コース別勝率（過去1ヶ月）                        │
│                                                 │
│ 1コース ████████████████████ 58.2%              │
│ 2コース ████████░░░░░░░░░░░ 15.3%              │
│ 3コース ███░░░░░░░░░░░░░░░░  8.7%              │
│ 4コース ████░░░░░░░░░░░░░░░ 10.2%              │
│ 5コース ██░░░░░░░░░░░░░░░░░  5.1%              │
│ 6コース █░░░░░░░░░░░░░░░░░░  2.5%              │
│                                                 │
│ ━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━           │
│ 🌊 気象条件と結果の相関                          │
│ ━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━           │
│                                                 │
│ [散布図: 風速 vs 1号艇勝率]                      │
│ [散布図: 波高 vs 平均配当]                       │
│                                                 │
└─────────────────────────────────────────────────┘
```

---

## 🔧 実装難易度と必要な変更

### 現状の確認

**既にあるもの ✅**:
1. スクレイピング機能（races.json に保存）
2. レース一覧表示
3. 選手情報の表示
4. 基本的なUIコンポーネント

**ないもの ❌**:
1. 過去データの蓄積
2. グラフ・チャート表示
3. 統計計算ロジック
4. 詳細な分析ページ
5. フィルタリング・検索機能

---

## 📝 実装の段階的アプローチ

### フェーズ1: 基礎（難易度: 易 ⭐）
**所要時間: 1-2日**

#### 1.1 UI変更
- 「AI予想を見る」→「データ分析を見る」に変更
- 予想結果セクションを「データ分析」セクションに変更
- AIスコアを削除または「参考スコア」に変更

#### 1.2 データ表示の強化
- 選手情報をより詳細に表示
- 今節成績の追加（既にスクレイピングデータに含まれている）
- モーター・ボート番号の強調表示

**実装例**:
```javascript
// App.jsx の変更
<button className="predict-btn" onClick={() => analyzeRace(race)}>
  データ分析を見る  // ← ここを変更
</button>

// 分析結果セクション
<section className="analysis-section">  // ← 名前変更
  <h2>📊 データ分析 - {selectedRace.venue} {selectedRace.raceNumber}R</h2>

  {/* AI予想部分を削除または縮小 */}

  {/* 詳細なデータテーブルを追加 */}
  <table className="detailed-stats-table">
    <thead>
      <tr>
        <th>艇番</th>
        <th>選手名</th>
        <th>級別</th>
        <th>全国勝率</th>
        <th>当地勝率</th>
        <th>モーター2率</th>
        <th>ボート2率</th>
        <th>今節成績</th>
      </tr>
    </thead>
    <tbody>
      {/* データを表示 */}
    </tbody>
  </table>
</section>
```

---

### フェーズ2: データ可視化（難易度: 中 ⭐⭐）
**所要時間: 3-5日**

#### 2.1 グラフライブラリの導入
```bash
npm install chart.js react-chartjs-2
```

#### 2.2 基本的なグラフの実装
- 選手の勝率を棒グラフで表示
- モーター2連率を棒グラフで表示
- コース別勝率（レース場統計）

**実装例**:
```javascript
import { Bar, Line } from 'react-chartjs-2';

function RaceAnalysis({ race, players }) {
  const chartData = {
    labels: players.map(p => `${p.number}号艇`),
    datasets: [{
      label: '全国勝率',
      data: players.map(p => p.winRate),
      backgroundColor: 'rgba(59, 130, 246, 0.5)',
    }]
  };

  return (
    <div>
      <h3>選手勝率の比較</h3>
      <Bar data={chartData} />
    </div>
  );
}
```

#### 2.3 統計情報の計算
- 平均値、中央値、標準偏差
- 最高値・最低値のハイライト
- 偏差値計算（全選手中での位置づけ）

**実装例**:
```javascript
function calculateStats(players) {
  const winRates = players.map(p => parseFloat(p.winRate));
  const average = winRates.reduce((a, b) => a + b) / winRates.length;
  const max = Math.max(...winRates);
  const min = Math.min(...winRates);

  return { average, max, min };
}
```

---

### フェーズ3: 過去データの蓄積（難易度: 中 ⭐⭐）
**所要時間: 3-5日**

#### 3.1 データ保存形式の変更
現在: `data/races.json` (1ファイル、当日データのみ)

変更後:
```
data/
  ├── 2025-11-28.json
  ├── 2025-11-29.json
  ├── 2025-11-30.json
  └── index.json  (インデックスファイル)
```

#### 3.2 GitHub Actions の変更
```yaml
# 既存のスクレイピング処理に追加
- name: Save daily data
  run: |
    DATE=$(date +%Y-%m-%d)
    cp data/races.json data/history/$DATE.json
    git add data/history/$DATE.json
```

#### 3.3 過去データの集計
- 選手の過去成績を集計
- レース場の統計を集計
- トレンド分析（過去7日、30日）

**実装例**:
```javascript
// 過去データの読み込み
async function loadHistoricalData(days = 30) {
  const dates = getLastNDays(days);
  const promises = dates.map(date =>
    fetch(`/data/history/${date}.json`)
      .then(res => res.json())
      .catch(() => null)
  );

  const results = await Promise.all(promises);
  return results.filter(r => r !== null);
}

// 選手の過去成績を抽出
function getPlayerHistory(playerName, historicalData) {
  const races = [];
  historicalData.forEach(day => {
    day.data.forEach(venue => {
      venue.races.forEach(race => {
        const racer = race.racers.find(r => r.name === playerName);
        if (racer) {
          races.push(racer);
        }
      });
    });
  });
  return races;
}
```

---

### フェーズ4: 選手詳細ページ（難易度: 中 ⭐⭐⭐）
**所要時間: 5-7日**

#### 4.1 ルーティングの追加
```bash
npm install react-router-dom
```

#### 4.2 選手ページの実装
```javascript
// App.jsx にルーティング追加
import { BrowserRouter, Routes, Route } from 'react-router-dom';

function App() {
  return (
    <BrowserRouter>
      <Routes>
        <Route path="/" element={<HomePage />} />
        <Route path="/racer/:name" element={<RacerDetailPage />} />
        <Route path="/stadium/:id" element={<StadiumAnalysisPage />} />
      </Routes>
    </BrowserRouter>
  );
}
```

#### 4.3 選手詳細データの表示
- 過去データから選手の履歴を抽出
- グラフで可視化
- レース場別成績
- 得意・苦手分析

---

### フェーズ5: 高度な分析機能（難易度: 高 ⭐⭐⭐⭐）
**所要時間: 1-2週間**

#### 5.1 レース場別統計
- コース別勝率
- 気象条件との相関分析
- ヒートマップ表示

#### 5.2 トレンド分析
- 移動平均線
- 季節性の分析
- 勝率の推移予測

#### 5.3 比較機能
- 複数選手の比較グラフ
- レース場間の比較
- 時系列比較

---

## 📊 実装難易度まとめ

| フェーズ | 機能 | 難易度 | 期間 | 優先度 |
|---------|------|--------|------|--------|
| 1 | UI変更・データ表示強化 | ⭐ 易 | 1-2日 | 🔴 高 |
| 2 | グラフ表示 | ⭐⭐ 中 | 3-5日 | 🔴 高 |
| 3 | 過去データ蓄積 | ⭐⭐ 中 | 3-5日 | 🟡 中 |
| 4 | 選手詳細ページ | ⭐⭐⭐ 中高 | 5-7日 | 🟡 中 |
| 5 | 高度な分析 | ⭐⭐⭐⭐ 高 | 1-2週間 | 🟢 低 |

---

## 🚀 推奨実装順序

### Week 1: MVP（最小限の価値提供）
✅ **フェーズ1: UI変更（1-2日）**
- 「AI予想」→「データ分析」に変更
- データテーブルの強化
- 今節成績の表示

✅ **フェーズ2: 基本的なグラフ表示（3-5日）**
- Chart.js 導入
- 勝率の棒グラフ
- モーター2連率のグラフ

**→ これだけで「予想サイト」から「データ分析サイト」に見え方が変わる**

### Week 2-3: データの充実
✅ **フェーズ3: 過去データの蓄積開始（3-5日）**
- GitHub Actions の変更
- 日次データの保存
- 過去データの表示（簡易版）

### Week 4-5: ページの拡充
✅ **フェーズ4: 選手詳細ページ（5-7日）**
- React Router 導入
- 選手ページの実装
- 過去成績の可視化

### Week 6以降: 高度な機能
✅ **フェーズ5: 高度な分析機能（随時追加）**

---

## 💻 最初の一歩: フェーズ1の具体的な実装

### 変更ファイル: `src/App.jsx`

#### 1. ボタンテキストの変更
```javascript
// 275行目あたり
<button
  className="predict-btn"
  onClick={() => analyzeRace(race)}
>
  データ分析を見る  // ← 変更
</button>
```

#### 2. セクションタイトルの変更
```javascript
// 286行目あたり
<h2>📊 データ分析 - {selectedRace.venue} {selectedRace.raceNumber}R</h2>
```

#### 3. AI予想部分の縮小
```javascript
// 予想根拠を削除または「統計的な注目ポイント」に変更
<div className="insights">
  <h4>📌 統計的な注目ポイント</h4>
  <ul>
    <li>1号艇の選手は当レース場での勝率が高い</li>
    <li>3号艇のモーターは今節好調</li>
    <li>風速が強いため内枠有利の可能性</li>
  </ul>
</div>
```

#### 4. データテーブルの強化
```javascript
<table className="players-table">
  <thead>
    <tr>
      <th>艇番</th>
      <th>選手名</th>
      <th>級別</th>
      <th>全国勝率</th>
      <th>当地勝率</th>
      <th>モーター</th>
      <th>モーター2率</th>
      <th>ボート</th>
      <th>ボート2率</th>
    </tr>
  </thead>
  <tbody>
    {prediction.allPlayers.map(player => (
      <tr key={player.number}>
        <td><strong>{player.number}</strong></td>
        <td>{player.name}</td>
        <td>{player.grade}</td>
        <td>{player.winRate}</td>
        <td>{player.localWinRate}</td>
        <td>{player.motorNumber}</td>
        <td>{player.motor2Rate}%</td>
        <td>{player.boatNumber}</td>
        <td>{player.boat2Rate}%</td>
      </tr>
    ))}
  </tbody>
</table>
```

---

## 🎯 期待される効果

### ユーザーから見た変化
**Before（予想サイト）**:
- 「AI予想を見る」→ 本命: 1号艇
- 的中しなければ信頼を失う

**After（データ分析サイト）**:
- 「データ分析を見る」→ 詳細な統計、グラフ
- 自分で判断できる材料を提供
- 的中率に依存しない価値

### SEO効果
- 「ボートレース データ」
- 「ボートレース 統計」
- 「選手名 + 成績」
などの検索流入が期待できる

### 差別化
- 予想サイトではなくツール・リソースとして位置づけ
- 継続的に価値を提供できる

---

## ❓ よくある質問

### Q1: 過去データはどのくらい必要？
A: 最低1ヶ月分あれば統計が出せる。理想は3-6ヶ月分。

### Q2: データベースは必要？
A: 不要。静的JSONファイルで十分対応可能。

### Q3: サーバーサイド処理は必要？
A: 不要。フロントエンドのJavaScriptで計算可能。

### Q4: 実装は全部必要？
A: いいえ。フェーズ1だけでも十分に価値提供できる。

### Q5: 今すぐ始められる？
A: はい。フェーズ1は既存コードの軽微な変更だけで実装可能。

---

**次のステップ**: フェーズ1の実装を始めますか？それとも他の方向性も検討しますか？
