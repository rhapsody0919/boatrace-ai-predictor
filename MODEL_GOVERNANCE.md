# モデル運用ガバナンス

## 🎯 モデルのライフサイクル管理

### 1. モデルステータスの定義

#### 🟢 本番稼働（Production）
**条件:**
- サンプル数 ≥ 500レース
- 回収率 > 100%（直近90日）
- 95%信頼区間の下限 > 95%
- 会場別で0%が3会場以下

**該当:** スタンダードモデル、穴狙いモデル（会場限定）

---

#### 🟡 観察期間（Monitoring）
**条件:**
- サンプル数 ≥ 200レース
- 回収率 90-100%（直近30日）
- または新規モデル（検証中）

**アクション:**
- 日次でパフォーマンス監視
- 週次でチューニング検討
- ユーザーには「試験運用中」と明記

---

#### 🔴 改善必要（Improvement Needed）
**条件:**
- 回収率 < 90%（直近30日連続）
- または会場別で0%が5会場以上

**アクション:**
- 即座にチューニング開始
- 2週間以内に改善しなければ一時停止

---

#### ⚫ 廃止（Deprecated）
**条件:**
- 回収率 < 80%（直近90日）
- またはチューニング後も改善なし

**アクション:**
- ユーザーへの告知（1週間前）
- データは保持（後日復活の可能性）
- 新モデルへの移行案内

---

## 📊 チューニング vs 廃止の判断フロー

```
モデルの回収率低下を検知
  ↓
[1] 原因分析
  ├─ 会場別で偏りがあるか？
  │   YES → 苦手会場を除外（会場フィルター）
  │   NO  → [2]へ
  ↓
[2] 時期的な要因か？
  ├─ 季節・天候の影響？
  │   YES → 条件付きモデルに変更
  │   NO  → [3]へ
  ↓
[3] パラメータの最適化
  ├─ 過去30日のデータで係数を再計算
  │   改善 → 本番適用（A/Bテスト）
  │   不変 → [4]へ
  ↓
[4] 根本的な問題
  ├─ モデルロジック自体が陳腐化
  │   → 新モデル開発を開始
  │   → 既存モデルは段階的廃止
```

---

## 🔄 A/Bテストの実装

### 目的
新モデルやチューニング後のモデルを本番投入前に検証

### 方法
```javascript
// 予想生成時に複数モデルを並行実行
const predictions = {
  'standard-v1': generateStandardPrediction(race),      // 既存
  'standard-v2': generateStandardPredictionV2(race),    // 新版
  'weather-adaptive': generateWeatherPrediction(race),  // 新モデル
};

// すべてを保存して後日比較
```

### 評価期間
- 最低30日（1ヶ月）
- 最低300レース

### 判定基準
```
新モデルの回収率 > 既存モデル + 5%
  → 本番切替

新モデルの回収率 > 既存モデル - 5%
  → 継続観察

新モデルの回収率 < 既存モデル - 5%
  → 廃止
```

---

## 📈 パフォーマンス監視指標

### 日次チェック
- [ ] 当日の的中率
- [ ] 当日の回収率
- [ ] 会場別の偏り

### 週次チェック
- [ ] 直近7日間の回収率
- [ ] 各モデルの比較
- [ ] 信頼区間の確認

### 月次チェック
- [ ] 月間回収率
- [ ] 会場別パフォーマンス
- [ ] モデル間の相関分析
- [ ] チューニングの必要性判断

---

## 🎓 説明可能性の担保

### ユーザーへの説明資料

#### 1. なぜ当たるのか
```
【スタンダードモデルの優位性】

✅ 統計的根拠:
  - 2,432レースで検証済み
  - 回収率132.63%（95%信頼区間: 124%-141%）
  - 統計的に有意な期待値プラス

✅ ロジックの透明性:
  - 全国勝率×100 + モーター性能×30 + ...
  - 各要素の重みは過去データから最適化
  - AIではなく統計モデル（説明可能）

✅ 一般的なボートレース理論との整合性:
  - 1号艇有利 → 枠番補正で対応
  - モーター性能重要 → 係数30で評価
  - 選手の実力 → 全国勝率で評価
```

#### 2. なぜ外れるのか
```
【外れる理由の正直な開示】

⚠️ ボートレースは確率のゲーム:
  - 1号艇でも勝率は約50%（全国平均）
  - 予期せぬ事故（転覆、フライング等）
  - 展示航走後の選手体調変化

⚠️ モデルの限界:
  - 取得していないデータ（展示タイム、ST）
  - 選手のメンタル状態
  - 水面の微妙な変化
```

#### 3. 期待値の説明
```
【長期的な視点】

✅ 短期では上下動あり:
  - 1日単位: -50% ~ +300%の変動あり
  - 1週間単位: 安定性向上
  - 1ヶ月単位: 期待値に収束

✅ 推奨する運用:
  - 最低100レース以上で評価
  - 1レースの投資額は全体の1%以下
  - 連続して負けても冷静に継続
```

---

## 🚨 アラート設定

### 緊急対応が必要なケース

```javascript
// 自動アラート条件
if (直近7日の回収率 < 70%) {
  alert('⚠️ 緊急: モデルパフォーマンス低下');
  // → 即座に原因分析開始
}

if (特定会場で10連敗) {
  alert('⚠️ 会場別異常検知');
  // → 該当会場を一時除外
}

if (新モデルが既存を30%上回る) {
  alert('✅ 新モデルが有望');
  // → 早期切替を検討
}
```

---

## 📝 まとめ

### チューニング推奨ケース
- 回収率 90-100%（改善の余地あり）
- 特定条件で偏りがある（会場、天候など）
- パラメータ調整で改善が期待できる

### 廃止推奨ケース
- 回収率 < 80%（長期的）
- チューニングしても改善なし
- よ良い代替モデルが存在

### 新モデル開発推奨ケース
- 既存モデルが全て90%以下
- 新しいデータソースが利用可能になった
- ユーザーからの強いニーズがある
