# Claude Code 効率的な使い方ガイド

## 📋 概要

このドキュメントは、CursorのClaude Code（Proプラン）を効率的に使用し、使用制限に引っかからないためのベストプラクティスをまとめています。エージェントにこのドキュメントを参照させ、適切なツール使用を指示してください。

## 🎯 基本原則

### 1. ツール呼び出しの最小化
- **原則**: 必要な時だけツールを呼び出す
- **実践**: 
  - 既に読み込んだファイルの内容を再度読み込まない
  - 推測できる情報は推測する（ただし、重要な判断は確認する）
  - 一度の会話で同じファイルを複数回読み込まない

### 2. バッチ処理の活用
- **原則**: 可能な限り複数のツール呼び出しを並列実行する
- **実践**:
  - 複数のファイルを読み込む場合は、一度に複数指定する
  - 複数の検索クエリは並列実行する
  - ファイルの読み込みと検索を同時に行う

### 3. 検索戦略の最適化
- **原則**: 適切な検索ツールを選択する
- **使い分け**:
  - `codebase_search`: 意味的な検索（「どのようにXが動作するか」など）
  - `grep`: 正確な文字列・シンボル検索（関数名、変数名など）
  - `glob_file_search`: ファイル名パターン検索

### 4. 不要な操作の回避
- **避けるべき操作**:
  - 既に確認済みのファイルの再読み込み
  - 明らかに不要なファイルの読み込み
  - 同じ検索クエリの繰り返し
  - リンターエラーの過度な確認（編集していないファイル）

## 🔧 具体的なベストプラクティス

### ファイル読み込み

#### ❌ 非効率的な例
```
1. read_file(file1)
2. read_file(file2)
3. read_file(file3)
```

#### ✅ 効率的な例
```
read_file(file1), read_file(file2), read_file(file3) を並列実行
```

### 検索の使い分け

#### ❌ 非効率的な例
```
1. codebase_search("関数名")
2. codebase_search("同じ関数名")
```

#### ✅ 効率的な例
```
- 関数名や変数名の検索 → grep を使用
- 意味的な検索 → codebase_search を使用（1回で十分）
```

### コンテキストの保持

#### ❌ 非効率的な例
```
1. ファイルAを読み込む
2. ファイルAを編集する
3. ファイルAを再度読み込んで確認する（不要）
```

#### ✅ 効率的な例
```
1. ファイルAを読み込む
2. ファイルAを編集する
3. リンターエラーを確認する（編集したファイルのみ）
```

### ディレクトリ構造の確認

#### ❌ 非効率的な例
```
1. list_dir(root)
2. list_dir(src)
3. list_dir(src/components)
```

#### ✅ 効率的な例
```
- 必要なディレクトリのみ確認
- プロジェクト構造が既に分かっている場合は確認をスキップ
```

## 📝 エージェントへの指示テンプレート

### 基本的な指示
```
以下のベストプラクティスに従って作業してください：
1. 複数のファイルを読み込む場合は並列実行する
2. 既に読み込んだファイルは再読み込みしない
3. 検索は適切なツールを選択し、重複を避ける
4. 編集していないファイルのリンターエラーは確認しない
```

### 複雑なタスクの場合
```
このタスクを実行する際は：
1. まず必要な情報を並列で収集する（ファイル読み込み、検索）
2. 収集した情報を基に実装計画を立てる
3. 実装を実行する
4. 編集したファイルのみリンターエラーを確認する
```

## 🚫 避けるべきパターン

### 1. 過度な確認
- 編集していないファイルのリンターエラー確認
- 既に確認済みの情報の再確認
- 明らかに不要なファイルの読み込み

### 2. 順次実行の多用
- 並列実行できる操作を順次実行する
- 同じ検索を複数回実行する

### 3. 広範囲な検索
- プロジェクト全体を対象とした不要な検索
- 既に分かっている情報の検索

## ✅ 推奨されるワークフロー

### タスク開始時
1. 必要な情報を並列で収集
   - 関連ファイルの読み込み（並列）
   - 必要な検索の実行（並列）
2. 情報を整理して計画を立てる
3. 実装を実行

### 実装中
1. 必要なファイルのみ読み込む
2. 既に読み込んだファイルは再読み込みしない
3. 編集したファイルのみリンターエラーを確認

### タスク完了時
1. 編集したファイルのみリンターエラーを確認
2. 不要なファイルの読み込みは行わない

## 📊 使用制限を避けるためのチェックリスト

エージェントに作業を依頼する前に、以下を確認：

- [ ] 必要な情報は一度に並列で収集できるか？
- [ ] 既に読み込んだファイルを再読み込みしていないか？
- [ ] 適切な検索ツールを選択しているか？
- [ ] 編集していないファイルのリンターエラーを確認していないか？
- [ ] 同じ検索クエリを繰り返していないか？
- [ ] 明らかに不要な操作をしていないか？

## 🎓 実践例

### 例1: 新機能の実装

#### ❌ 非効率的
```
1. codebase_search("関連機能")
2. read_file(file1)
3. codebase_search("同じ関連機能")  // 重複
4. read_file(file2)
5. read_file(file1)  // 再読み込み
```

#### ✅ 効率的
```
1. codebase_search("関連機能") と read_file(file1) と read_file(file2) を並列実行
2. 収集した情報を基に実装
3. 編集したファイルのみリンターエラー確認
```

### 例2: バグ修正

#### ❌ 非効率的
```
1. read_file(エラーが発生しているファイル)
2. grep("エラーメッセージ")
3. read_file(同じファイル)  // 再読み込み
4. 全ファイルのリンターエラー確認
```

#### ✅ 効率的
```
1. read_file(エラーが発生しているファイル) と grep("エラーメッセージ") を並列実行
2. 修正を実行
3. 修正したファイルのみリンターエラー確認
```

## 🔄 継続的な改善

### モニタリング
- 使用制限に引っかかった場合は、どの操作が原因だったか記録する
- パターンを特定して、このドキュメントを更新する

### フィードバック
- 効率的な使い方が見つかったら、このドキュメントに追加する
- エージェントへの指示を改善する

## 📌 重要な注意事項

1. **品質と効率のバランス**: 効率を追求しすぎて、重要な確認を省略しない
2. **コンテキストの重要性**: 必要な情報は確実に収集する
3. **エラーの早期発見**: 実装後は必ずリンターエラーを確認する（編集したファイルのみ）

## 🎯 まとめ

使用制限を避けるための3つの鍵：
1. **並列実行**: 可能な限り複数の操作を同時に行う
2. **重複回避**: 同じ操作を繰り返さない
3. **適切な選択**: 最適なツールを選択する

エージェントに作業を依頼する際は、このドキュメントを参照させ、上記の原則に従うよう指示してください。

