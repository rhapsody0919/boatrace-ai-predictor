# ボートレースAI予測アプリケーション - 画面設計書

## 1. はじめに（目的）

### 1.1 本ドキュメントの目的

本画面設計書は、ボートレースAI予測アプリケーションのフロントエンド実装における画面構成、UIコンポーネント、レイアウト、インタラクション、状態管理を明確に定義することを目的としています。

### 1.2 対象読者

- フロントエンドエンジニア（React実装担当者）
- UI/UXデザイナー
- プロダクトマネージャー
- QAエンジニア

### 1.3 アプリケーション概要

ボートレースAI予測アプリケーションは、リアルタイムでボートレースデータを取得し、簡易的な予測機能でレース結果の推奨をユーザーに提供するWebアプリケーションです。

### 1.4 主要なユーザーシナリオ

1. **レース閲覧**: ユーザーがアプリケーションにアクセスし、当日開催されるレース一覧を閲覧する
2. **レース選択**: ユーザーが興味のあるレースを選択し、「AI予想を見る」ボタンをクリックする
3. **予測結果確認**: AI分析が実行され、予測結果（本命予想、AIスコア、予想根拠）が表示される
4. **詳細情報確認**: 全艇の情報をテーブル形式で確認し、投票判断の参考にする

## 2. 画面一覧と画面遷移図

### 2.1 画面構成

本アプリケーションは**単一画面（SPA: Single Page Application）**で構成されており、状態によって表示内容が動的に変化します。

### 2.2 画面遷移フロー

```
[初回アクセス]
    ↓
[ローディング状態]
    ↓
[レース一覧表示] ←→ [エラー表示（API失敗時）]
    ↓
[レース選択]（「AI予想を見る」ボタンクリック）
    ↓
[AI分析中（ローディング）]
    ↓
[予測結果表示]
    ↓
（別のレースを選択可能）
```

### 2.3 画面状態の種類

| 状態 | 説明 |
|------|------|
| **初期ローディング** | アプリ起動時、APIからレースデータを取得中 |
| **レース一覧表示** | 取得したレース一覧を表示（通常状態） |
| **エラー表示** | API取得失敗時のエラーメッセージ表示 |
| **AI分析中** | レース選択後、予測計算中のローディング表示 |
| **予測結果表示** | AI予測結果を表示（レース一覧と併存） |

## 3. 各画面の詳細設計

### 3.1 メイン画面（レース一覧＋予測結果表示）

#### 3.1.1 画面名と目的

- **画面名**: メイン画面（ホーム画面）
- **目的**: ユーザーが当日のレース情報を閲覧し、興味のあるレースのAI予測を取得する

#### 3.1.2 レイアウト構成

##### デスクトップレイアウト（1024px以上）

```
+------------------------------------------------------------------+
|                     [ヘッダー広告バナー]                          |
+------------------------------------------------------------------+
|                        🏁 ボートレースAI予想                       |
+------------------------------------------------------------------+
| [サイド]  |              [メインコンテンツ]              | [サイド] |
| [広告左] |                                             | [広告右] |
|         |  +---------------------------------------+  |         |
|         |  | 📅 本日のレース                     |  |         |
|         |  |                                       |  |         |
|         |  | [実データ取得] or [サンプルデータ]     |  |         |
|         |  |                                       |  |         |
|         |  | レース場を選択: [▼ドロップダウン]     |  |         |
|         |  |                                       |  |         |
|         |  | +-----------------------------------+ |  |         |
|         |  | | 1R  | 10:30 | 天候 | 波高 | 風速 | |  |         |
|         |  | | [AI予想を見る]ボタン               | |  |         |
|         |  | +-----------------------------------+ |  |         |
|         |  | | 2R  | 11:00 | 天候 | 波高 | 風速 | |  |         |
|         |  | | [AI予想を見る]ボタン               | |  |         |
|         |  | +-----------------------------------+ |  |         |
|         |  | （選択したレース場のレース一覧：1-12R）|  |         |
|         |  +---------------------------------------+  |         |
|         |                                             |         |
|         |  +---------------------------------------+  |         |
|         |  |     [コンテンツ内広告バナー]          |  |         |
|         |  +---------------------------------------+  |         |
|         |                                             |         |
|         |  +---------------------------------------+  |         |
|         |  | 📊 AI予想結果（選択時のみ表示）       |  |         |
|         |  |                                       |  |         |
|         |  | AI信頼度: [プログレスバー]            |  |         |
|         |  |                                       |  |         |
|         |  | 🥇 本命予想                           |  |         |
|         |  | [選手カード：艇番、名前、年齢など]    |  |         |
|         |  |                                       |  |         |
|         |  | 📌 予想根拠                           |  |         |
|         |  | - 理由1                               |  |         |
|         |  | - 理由2                               |  |         |
|         |  |                                       |  |         |
|         |  | 全艇情報テーブル                       |  |         |
|         |  | [艇番 | 名前 | 年齢 | AIスコア]      |  |         |
|         |  +---------------------------------------+  |         |
+------------------------------------------------------------------+
|                    [フッター広告バナー]                           |
+------------------------------------------------------------------+
|                       [免責事項 & 著作権]                         |
+------------------------------------------------------------------+
```

##### タブレットレイアウト（768px～1023px）

- サイドバー広告を非表示
- メインコンテンツを中央に配置（幅100%）
- ヘッダー・コンテンツ内・フッター広告は表示

##### モバイルレイアウト（768px未満）

- 1カラムレイアウト
- すべての広告バナーをレスポンシブに縮小またはスタック表示
- レース一覧カードを縦積み
- テーブルをスクロール可能に

#### 3.1.3 UIコンポーネント一覧

| コンポーネント名 | 種類 | 配置位置 | 説明 |
|-----------------|------|----------|------|
| **ヘッダー広告バナー** | 広告コンポーネント | 最上部 | 728x90ピクセル |
| **アプリタイトル** | テキストヘッダー | ヘッダー | 「🏁 ボートレースAI予想」 |
| **サイドバー広告（左）** | 広告コンポーネント | 左サイド | 160x600ピクセル（PC のみ） |
| **サイドバー広告（右）** | 広告コンポーネント | 右サイド | 160x600ピクセル（PC のみ） |
| **データソース表示** | バッジ | メインコンテンツ上部 | 「実データ取得」または「サンプルデータ」 |
| **レース場選択ドロップダウン** | セレクトボックス | メインコンテンツ上部 | 全24レース場から選択 |
| **レース一覧セクション** | セクション | メインコンテンツ | 選択したレース場のレース（1-12R）を表示 |
| **レースカード** | カード | レース一覧内 | 1レースごとの情報カード |
| **AI予想ボタン** | ボタン | レースカード内 | 「AI予想を見る」 |
| **コンテンツ内広告** | 広告コンポーネント | メインコンテンツ中央 | 728x90ピクセル |
| **予測結果セクション** | セクション | メインコンテンツ下部 | 選択時のみ表示 |
| **信頼度バー** | プログレスバー | 予測結果内 | AI信頼度を視覚化 |
| **本命予想カード** | カード（強調） | 予測結果内 | トップピック選手情報 |
| **予想根拠リスト** | リスト | 予測結果内 | 箇条書き |
| **全艇情報テーブル** | テーブル | 予測結果内 | 6艇分のデータ |
| **フッター広告バナー** | 広告コンポーネント | フッター上部 | 728x90ピクセル |
| **フッター** | フッター | 最下部 | 免責事項と著作権 |

#### 3.1.4 データ表示要件

##### レース一覧データ

| データ項目 | 形式 | 取得元 | フォールバック |
|-----------|------|--------|---------------|
| レース場名 | 文字列 | API → stadiumNames マッピング | サンプルデータ |
| レース番号 | 数値（1-12） | API | サンプルデータ |
| 発走時刻 | HH:MM形式 | API → 計算 | サンプルデータ |
| 天候 | 文字列 | API | 「晴れ」「曇り」「雨」 |
| 波高 | 数値 + 単位（cm） | API | ランダム（1-5） |
| 風速 | 数値 + 単位（m） | API | ランダム（1-8） |

##### 予測結果データ

| データ項目 | 形式 | 説明 |
|-----------|------|------|
| AI信頼度 | パーセント（70-95%） | 予測の信頼性 |
| 艇番 | 数値（1-6） | 選手の艇番号 |
| 選手名 | 文字列 | サンプル名生成 |
| 年齢 | 数値（歳） | 20-50歳の範囲 |
| 勝率 | 小数点1桁 | 例: 6.8 |
| モーター勝率 | 小数点1桁 | 例: 35.2% |
| AIスコア | 小数点1桁 | 80.0-95.0 |
| 予想根拠 | 文字列配列 | 3-5個の理由 |

#### 3.1.5 インタラクション設計

##### 主要操作

| 操作 | トリガー | アクション | フィードバック |
|------|---------|-----------|---------------|
| **ページ読み込み** | 初回アクセス | API データ取得開始 | ローディング表示「レースデータを取得中...」 |
| **AI予想ボタンクリック** | ユーザークリック | 予測処理開始 | ボタン無効化、ローディング表示「AIが分析中...」 |
| **予測完了** | 予測処理終了 | 予測結果セクション表示 | スムーズなスクロールで結果位置へ移動 |
| **別レース選択** | 別のボタンクリック | 新しい予測処理 | 前の予測結果を更新 |

##### ボタン状態

| 状態 | 表示 | 説明 |
|------|------|------|
| **通常** | 「AI予想を見る」 | クリック可能、ホバー時にハイライト |
| **ローディング中** | 無効化 | クリック不可、カーソルはwait |
| **選択済み** | 「AI予想を見る」 | 再度クリック可能（予測再実行） |

#### 3.1.6 エラーハンドリング

##### エラーケース一覧

| エラー種類 | 発生条件 | 表示内容 | ユーザーアクション |
|-----------|---------|---------|-------------------|
| **API接続エラー** | ネットワーク障害 | 「APIからデータを取得できませんでした」 | 自動的にサンプルデータ表示 |
| **APIタイムアウト** | 応答が10秒超過 | 「タイムアウトしました」 | サンプルデータにフォールバック |
| **データ不整合** | レスポンス形式異常 | 「データ形式が不正です」 | サンプルデータ表示 |
| **予測処理エラー** | 予測ロジック失敗 | 「予測処理に失敗しました」 | エラーメッセージ表示、再試行可能 |

##### エラー表示デザイン

```
+------------------------------------------------+
| ⚠️ エラーメッセージ                            |
|                                                |
| APIからデータを取得できませんでした              |
| サンプルデータを表示しています                  |
+------------------------------------------------+
```

### 3.2 ローディング状態画面

#### 3.2.1 初期ローディング

```
+------------------------------------------------+
|                                                |
|              [スピナーアニメーション]           |
|                                                |
|          レースデータを取得中...                |
|                                                |
+------------------------------------------------+
```

#### 3.2.2 AI分析中ローディング

```
+------------------------------------------------+
| 📊 AI予想結果                                  |
|                                                |
|              [スピナーアニメーション]           |
|                                                |
|            AIが分析中...                        |
|   過去データ、モーター性能、気象条件を解析中    |
|                                                |
+------------------------------------------------+
```

## 4. 共通コンポーネント設計

### 4.1 レース場選択ドロップダウンコンポーネント

#### コンポーネント名
`VenueSelector`

#### Props定義

```typescript
interface VenueSelectorProps {
  venues: Array<{
    id: number;          // レース場番号（1-24）
    name: string;        // レース場名
  }>;
  selectedVenueId: number | null;  // 選択中のレース場ID
  onVenueChange: (venueId: number) => void;  // レース場変更時
}
```

#### 表示内容

- ラベル: 「レース場を選択:」
- ドロップダウン（セレクトボックス）: 全24レース場のリスト
- デフォルト選択肢: 「レース場を選択してください」または最初のレース場

#### スタイル要件

- 幅: 最大300px（モバイルでは100%）
- フォントサイズ: 16px（読みやすさ重視）
- 背景色: 白、ボーダー: グレー系
- ホバー時: 薄い背景色変化
- フォーカス時: 青い枠線でハイライト

#### 使用箇所

- メイン画面のレース一覧セクション上部

### 4.2 レースカードコンポーネント

#### コンポーネント名
`RaceCard`

#### Props定義

```typescript
interface RaceCardProps {
  race: {
    id: string | number;
    venue: string;          // レース場名
    raceNumber: number;     // レース番号（1-12）
    startTime: string;      // 発走時刻（HH:MM）
    weather: string;        // 天候
    wave: number;           // 波高（cm）
    wind: number;           // 風速（m）
  };
  onPredictClick: (race: Race) => void;  // 予想ボタンクリック時
}
```

#### 表示内容

- レース場名（大きく表示）
- レース番号（「〇〇R」形式）
- 発走時刻
- 天候、波高、風速（アイコン付き）
- 「AI予想を見る」ボタン

#### スタイル要件

- カード形式（border-radius、shadow）
- ホバー時にカード全体を軽くハイライト
- ボタンは視認性の高い色（例: 青系）

#### 使用箇所

- メイン画面のレース一覧セクション

### 4.2 予測結果コンポーネント

#### コンポーネント名
`PredictionResult`

#### Props定義

```typescript
interface PredictionResultProps {
  prediction: {
    confidence: number;           // AI信頼度（%）
    topPick: PlayerInfo;          // 本命予想
    reasoning: string[];          // 予想根拠
    allPlayers: PlayerInfo[];     // 全艇情報
  };
  selectedRace: {
    venue: string;
    raceNumber: number;
  };
}

interface PlayerInfo {
  number: number;        // 艇番（1-6）
  name: string;          // 選手名
  age: number;           // 年齢
  winRate: number;       // 勝率
  motorWinRate: number;  // モーター勝率
  aiScore: number;       // AIスコア
}
```

#### 表示内容

1. **ヘッダー**: 「📊 AI予想結果 - {レース場} {レース番号}R」
2. **信頼度バー**: プログレスバー + パーセント表示
3. **本命予想カード**: 選手情報を目立つカード形式で表示
4. **予想根拠**: 箇条書きリスト
5. **全艇情報テーブル**: 6艇分のデータを表形式で表示

#### スタイル要件

- セクション全体に背景色を設定して区別
- 本命予想カードは強調（大きめ、影、太字）
- テーブルは1-3番艇を薄い背景色でハイライト

#### 使用箇所

- メイン画面の予測結果セクション

### 4.3 広告バナーコンポーネント

#### コンポーネント名
`AdBanner`

#### Props定義

```typescript
interface AdBannerProps {
  size: 'header' | 'sidebar' | 'content' | 'footer';
  text?: string;  // プレースホルダーテキスト
}
```

#### サイズ仕様

| サイズ種類 | ピクセル | 配置場所 |
|-----------|---------|----------|
| `header` | 728x90 | ヘッダー |
| `sidebar` | 160x600 | サイドバー左右 |
| `content` | 728x90 | コンテンツ内 |
| `footer` | 728x90 | フッター上部 |

#### 表示内容

- プレースホルダー: 「📢 広告スペース (サイズ)」
- 実装時はGoogle AdSenseなどの広告コードに置き換え

#### 使用箇所

- ヘッダー、サイドバー左右、コンテンツ内、フッター

### 4.4 ローディングコンポーネント

#### コンポーネント名
`LoadingSpinner`

#### Props定義

```typescript
interface LoadingSpinnerProps {
  message: string;           // ローディングメッセージ
  detail?: string;           // 詳細メッセージ（オプション）
}
```

#### 表示内容

- 回転するスピナーアニメーション
- メインメッセージ（例: 「レースデータを取得中...」）
- 詳細メッセージ（例: 「過去データ、モーター性能、気象条件を解析中」）

#### スタイル要件

- 中央配置
- スピナーはCSS animationで回転
- メッセージはグレー系の色

#### 使用箇所

- 初期ローディング時
- AI分析中

### 4.5 エラーメッセージコンポーネント

#### コンポーネント名
`ErrorMessage`

#### Props定義

```typescript
interface ErrorMessageProps {
  message: string;           // エラーメッセージ
  type?: 'error' | 'warning' | 'info';
}
```

#### 表示内容

- ⚠️ アイコン
- エラーメッセージテキスト

#### スタイル要件

- 赤系の背景色（error）または黄色系（warning）
- 白いテキスト
- border-radius で角を丸く

#### 使用箇所

- API エラー時
- 予測処理エラー時

### 4.6 データソースバッジコンポーネント

#### コンポーネント名
`DataSourceBadge`

#### Props定義

```typescript
interface DataSourceBadgeProps {
  isRealData: boolean;  // 実データか否か
}
```

#### 表示内容

- 実データ時: 「✓ 実データ取得」（緑色）
- サンプルデータ時: 「⚠️ サンプルデータ」（黄色）

#### スタイル要件

- バッジ形式（小さめ、角丸、背景色付き）
- レース一覧の上部に配置

#### 使用箇所

- レース一覧セクション上部

## 5. 状態管理設計

### 5.1 React State一覧

| State名 | 型 | 初期値 | 説明 | 更新タイミング |
|---------|---|--------|------|---------------|
| `allRacesData` | `Map<number, Race[]>` | `new Map()` | 全レース場のデータ（レース場ID→レース配列） | API取得時またはサンプルデータ生成時 |
| `selectedVenueId` | `number \| null` | `null` | 選択中のレース場ID | レース場ドロップダウン変更時 |
| `displayedRaces` | `Race[]` | `[]` | 表示中のレース一覧（選択したレース場のレース） | レース場選択時に`allRacesData`からフィルタ |
| `selectedRace` | `Race \| null` | `null` | 選択中のレース | 「AI予想を見る」クリック時 |
| `prediction` | `Prediction \| null` | `null` | 予測結果データ | 予測処理完了時 |
| `isAnalyzing` | `boolean` | `false` | AI分析中フラグ | 予測開始時に`true`、完了時に`false` |
| `loading` | `boolean` | `true` | 初期ロード中フラグ | アプリ起動時`true`、データ取得完了時`false` |
| `error` | `string \| null` | `null` | エラーメッセージ | エラー発生時に設定 |
| `isRealData` | `boolean` | `false` | 実データ取得フラグ | API成功時`true`、サンプルデータ時`false` |

### 5.2 useEffect使用箇所

#### 初期データ取得

```javascript
useEffect(() => {
  const fetchRaceData = async () => {
    try {
      setLoading(true);
      setError(null);

      const response = await fetch('https://boatraceopenapi.github.io/results/v2/today.json');

      if (!response.ok) {
        throw new Error('APIからデータを取得できませんでした');
      }

      const data = await response.json();

      // データ変換処理
      const racesByStadium = groupRacesByStadium(data.results);
      const upcomingRaces = formatRaces(racesByStadium);

      if (upcomingRaces.length > 0) {
        setRaces(upcomingRaces);
        setIsRealData(true);
      } else {
        throw new Error('データが空です');
      }
    } catch (err) {
      console.error(err);
      setError(err.message);
      // フォールバック: サンプルデータ生成
      setRaces(generateSampleRaces());
      setIsRealData(false);
    } finally {
      setLoading(false);
    }
  };

  fetchRaceData();
}, []); // 初回レンダリング時のみ実行
```

### 5.3 状態遷移図

```
[初期状態]
  loading: true
  races: []
    ↓
[API取得成功]
  loading: false
  races: [データ]
  isRealData: true
    ↓
[レース選択]
  selectedRace: Race
  isAnalyzing: true
    ↓
[予測完了]
  prediction: Prediction
  isAnalyzing: false
```

## 6. レスポンシブデザイン仕様

### 6.1 ブレークポイント定義

| ブレークポイント | デバイス | 幅 |
|-----------------|----------|-----|
| **モバイル** | スマートフォン | 0px～767px |
| **タブレット** | タブレット | 768px～1023px |
| **デスクトップ** | PC | 1024px以上 |

### 6.2 各ブレークポイントでのレイアウト変更

#### デスクトップ（1024px以上）

- 3カラムレイアウト（サイドバー左 + メイン + サイドバー右）
- すべての広告バナー表示
- レースカードは2-3列のグリッド表示
- テーブルは横スクロールなしで全カラム表示

#### タブレット（768px～1023px）

- 1カラムレイアウト（メインのみ）
- サイドバー広告は非表示
- ヘッダー、コンテンツ内、フッター広告は表示
- レースカードは2列グリッド
- テーブルは横スクロール可能

#### モバイル（768px未満）

- 1カラムレイアウト
- 広告バナーはレスポンシブに縮小または非表示
- レースカードは1列縦積み
- テーブルは横スクロール必須
- フォントサイズを調整（やや大きめ）
- ボタンのタップ領域を拡大（最低44x44px）

### 6.3 CSS メディアクエリ例

```css
/* デスクトップ */
@media (min-width: 1024px) {
  .container {
    display: grid;
    grid-template-columns: 160px 1fr 160px;
    gap: 20px;
  }

  .sidebar-ad {
    display: block;
  }
}

/* タブレット */
@media (min-width: 768px) and (max-width: 1023px) {
  .container {
    display: block;
    max-width: 900px;
    margin: 0 auto;
  }

  .sidebar-ad {
    display: none;
  }

  .race-grid {
    grid-template-columns: repeat(2, 1fr);
  }
}

/* モバイル */
@media (max-width: 767px) {
  .container {
    display: block;
    padding: 10px;
  }

  .sidebar-ad,
  .vertical-ad {
    display: none;
  }

  .race-grid {
    grid-template-columns: 1fr;
  }

  .players-table {
    overflow-x: auto;
  }
}
```

## 7. アクセシビリティ考慮事項

### 7.1 キーボード操作

- すべてのボタンは`<button>`タグを使用し、Tabキーでフォーカス可能
- フォーカス時には明確なアウトライン表示
- Enterキーでボタンをアクティブ化可能

### 7.2 スクリーンリーダー対応

- `alt`属性を画像に設定
- ボタンには`aria-label`を設定（必要に応じて）
- ローディング中は`aria-busy="true"`を設定
- エラーメッセージには`role="alert"`を設定

### 7.3 色のコントラスト比

- WCAG AA基準を満たすコントラスト比（4.5:1以上）
- テキストと背景のコントラストを確保
- リンクやボタンは色だけでなく、アンダーラインや枠線でも識別可能に

### 7.4 フォーカス表示

- フォーカス時には`outline: 2px solid #007bff;`などで明確に表示
- `:focus-visible`を使用してキーボード操作時のみアウトライン表示

### 7.5 セマンティックHTML

- `<header>`, `<main>`, `<footer>`, `<section>`などを適切に使用
- 見出しレベル（`<h1>`, `<h2>`, `<h3>`）を論理的に構造化

## 8. 実装上の注意事項

### 8.1 パフォーマンスに関する考慮事項

#### メモ化の活用

- `React.memo`で不要な再レンダリングを防止
- `useMemo`で重い計算処理をキャッシュ
- `useCallback`でコールバック関数を最適化

```javascript
const RaceCard = React.memo(({ race, onPredictClick }) => {
  // コンポーネント実装
});

const handlePredictClick = useCallback((race) => {
  analyzeRace(race);
}, []);
```

#### 画像の最適化

- 広告バナーの画像はWebP形式を推奨
- 遅延ロード（lazy loading）を活用

#### コード分割

- 必要に応じて`React.lazy`と`Suspense`でコード分割

### 8.2 外部APIとの連携時の注意点

#### タイムアウト設定

- `fetch`にタイムアウトを設定（10秒）
- AbortControllerを使用して中断可能に

```javascript
const controller = new AbortController();
const timeoutId = setTimeout(() => controller.abort(), 10000);

try {
  const response = await fetch(url, { signal: controller.signal });
  clearTimeout(timeoutId);
  // 処理続行
} catch (error) {
  if (error.name === 'AbortError') {
    // タイムアウト処理
  }
}
```

#### CORSエラー対策

- Vercelからのfetchは問題ないが、開発環境でCORSエラーが出る場合はプロキシ設定を確認

#### データバリデーション

- API レスポンスは必ずバリデーション
- 必須フィールドの存在確認
- 型チェック（TypeScriptを推奨）

### 8.3 エラーハンドリングの実装方針

#### try-catch でエラーを捕捉

```javascript
try {
  // API呼び出しや処理
} catch (error) {
  console.error('エラー詳細:', error);
  setError('わかりやすいエラーメッセージ');
}
```

#### ユーザーフレンドリーなメッセージ

- 技術的な詳細は表示せず、ユーザーが理解できるメッセージを表示
- 例: 「APIからデータを取得できませんでした」

#### フォールバック処理の自動化

- エラー時は自動的にサンプルデータにフォールバック
- ユーザーが何もしなくてもアプリは動作し続ける

### 8.4 テスト容易性を考慮したコンポーネント設計

#### Propsで依存を注入

- コンポーネントは外部依存をPropsで受け取る
- API呼び出し処理は親コンポーネントまたはカスタムフックに分離

```javascript
// テストしやすい設計
function RaceCard({ race, onPredictClick }) {
  return (
    <div>
      <h3>{race.venue}</h3>
      <button onClick={() => onPredictClick(race)}>AI予想を見る</button>
    </div>
  );
}
```

#### data-testid属性の付与

- テストで要素を特定しやすくするため、主要要素に`data-testid`を付与

```jsx
<button data-testid="predict-button" onClick={handleClick}>
  AI予想を見る
</button>
```

#### カスタムフックの分離

- データ取得ロジックはカスタムフックに分離してテスト可能に

```javascript
function useRaceData() {
  const [races, setRaces] = useState([]);
  const [loading, setLoading] = useState(true);
  const [error, setError] = useState(null);

  useEffect(() => {
    // データ取得処理
  }, []);

  return { races, loading, error };
}
```

### 8.5 セキュリティ考慮事項

#### XSS対策

- Reactのデフォルト機能（自動エスケープ）を活用
- `dangerouslySetInnerHTML`は使用しない

#### 外部データのサニタイズ

- API から受け取ったデータは信頼せず、必ずバリデーション
- HTMLタグが含まれる可能性がある場合はサニタイズライブラリを使用

### 8.6 デプロイ時の注意事項

#### ビルド設定

- Vite の基本設定で問題なくVercelにデプロイ可能
- Vercelは自動的にViteプロジェクトを検出し、適切なビルドコマンドを実行

```javascript
export default defineConfig({
  plugins: [react()],
  // Vercelの場合はbaseパス設定は不要（ルートパスで配信される）
});
```

#### Vercelデプロイ手順

1. Vercelアカウントにログイン
2. GitHubリポジトリをインポート
3. プロジェクト設定（自動検出されるので通常は変更不要）
   - Framework Preset: Vite
   - Build Command: `npm run build`
   - Output Directory: `dist`
4. デプロイボタンをクリック
5. 自動的にビルド＆デプロイが実行される

#### 環境変数

- API URLなどは環境変数で管理
- `.env`ファイルは`.gitignore`に追加

---

**文書作成日**: 2025-11-27
**対象プロジェクト**: ボートレースAI予測アプリケーション
**バージョン**: 1.0
**次回更新**: デザインモックアップ作成後に詳細なスタイル仕様を追記予定
