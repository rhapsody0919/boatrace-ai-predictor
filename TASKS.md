# タスク管理

## 🔴 優先度: 高（次にやること）

### モデル導入 - 残りのタスク
- [ ] モデルを5つに増やす
  - **現状**: 3モデル（standard, safeBet, upsetFocus）で運用中
  - **方針**: データが十分に貯まるまで（最低100レース程度）は3モデルで継続
  - **実装済み**: データ構造は将来的なモデル追加に対応済み

- [x] 的中レースページのモデル対応（2025-12-19完了）
  - **実装済み**: 的中率統計ページ（AccuracyDashboard.jsx）は3モデル対応済み
  - **実装済み**: 的中レースページ（HitRaces.jsx）も3モデル対応済み
    - モデル選択タブ（スタンダード、本命狙い、穴狙い）を実装
    - モデル別の的中レース抽出ロジックを実装
    - データの後方互換性も対応

- [ ] DB移行の検討・実装
  - **現状**: JSON形式で約2,000レース分のデータを保持
  - **推奨移行時期**: 3～4ヶ月後（レース数5,000～10,000件になったら）
  - **推奨DB**: Supabase（PostgreSQL、無料プラン500MB）
  - **理由**: ファイルサイズ増加によるビルド時間・読み込み速度の低下を防ぐ

- [ ] 各競艇場ごとの統計
  - 例: Aモデル/Bモデル/Cモデルごとに、各競艇場での単勝/複勝/3連複/3連単の的中率・回収率を算出
  - 競艇場ごとに得意なモデルを特定し、苦手な競艇場は手を出さない戦略を提示

- [ ] 荒れ度の根拠説明を記載
  - 現在は「荒れ度」を表示しているが、その計算根拠を明示する

- [ ] おすすめモデルの表示
  - 当日のレース傾向から、どのモデルがおすすめかを自動判定して表示


### 1. DNS反映の確認 ⏳
- [ ] 定期的に`nslookup boat-ai.jp 8.8.8.8`を実行
- [ ] `216.198.79.1`が表示されたら完了
- [ ] `https://boat-ai.jp`にアクセスして動作確認
- [ ] Vercel DomainsページでInvalid → Valid になることを確認
- **予想時間:** 2～24時間

### 2. Google Analytics設置（DNS反映後）
- [ ] Google Analyticsアカウント作成
- [ ] プロパティ作成（boat-ai.jp）
- [ ] 測定IDを取得
- [ ] `index.html`にトラッキングコードを追加
- [ ] 動作確認（リアルタイムレポート）
- **目的:** トラフィック分析、AdSense審査でもプラス

### 3. Google AdSense申請（DNS反映後）
- [ ] Google AdSenseアカウント作成
- [ ] サイト情報を登録（boat-ai.jp）
- [ ] AdSenseコードを`index.html`に追加
- [ ] 審査申請
- [ ] 審査完了を待つ（1～2週間）
- **目的:** 広告収入の獲得

### 4. noteコンテンツ販売
- [ ] 記事1本目を執筆「競艇AI予測を708レースで検証した結果」
  - データ分析結果をまとめる
  - 的中率と回収率の推移
  - 有効な使い方のアドバイス
- [ ] 価格設定: 980円
- [ ] noteに投稿
- **目的:** コンテンツ販売収益

---

## ⏸️ 保留中（優先度: 低）

### SendGrid設定
- [ ] SendGridアカウント作成（無料プラン）
- [ ] Sender Authentication完了
- [ ] API Key作成
- [ ] GitHub Secretsに設定
  - `SENDGRID_API_KEY`
  - `FROM_EMAIL`（rapsody919@gmail.com）
  - `TO_EMAIL`（rapsody919@gmail.com）
- [ ] メール通知ワークフローを手動実行してテスト
- **備考:** 必須ではないため保留中

---

## ✅ 完了済み

### モデル導入 - 3モデル統計表示の実装（2025-12-19完了）

#### 1. 的中率統計ページの大幅改善
- [x] モデル間パフォーマンス比較表の改善
  - [x] 複勝と3連複のカラムを追加（単勝/複勝/3連複/3連単の4券種を表示）
  - [x] テキスト色の視認性を改善（背景色とのコントラスト問題を解決）
  - [x] 選択中のモデル行をハイライト表示

- [x] 不要なセクションの削除
  - [x] 「今月のベストパフォーマンスモデル」セクションを削除
  - [x] 「今月の最高記録日」セクションを削除
  - [x] UIをシンプル化し、重要な情報に集中

- [x] グラフ表示位置の最適化
  - [x] 回収率推移グラフを「直近のパフォーマンステーブル」の下に移動
  - [x] データの流れを自然に（表 → グラフ → 説明）

- [x] データ範囲の明確化
  - [x] モデル間比較表: 「今月: MM/DD - MM/DD」と日付範囲を表示
  - [x] 直近のパフォーマンス: 「直近7日間のパフォーマンス (MM/DD - MM/DD)」と表記

#### 2. 重大なバグ修正
- [x] モデル別統計の回収率計算バグを修正
  - **問題**: safeBet/upsetFocusの回収率計算時に、全レース（2,043レース）のデータが使用されていた
  - **原因**: `calculateModelSummaryStats`関数で、`calculateActualRecovery`に全レースを渡していた
  - **修正**: フィルタされた`finishedRaces`（モデル別データのみ）を渡すように変更
  - **結果**:
    - 修正前: safeBet 3連単回収率 136.3%（誤）
    - 修正後: safeBet 3連単回収率 62.7%（正）

- [x] public/data/predictions/summary.jsonの同期問題を解決
  - **問題**: ブラウザに配信される`public/data/`に古いデータが残っていた
  - **修正**: `data/predictions/summary.json`を`public/data/predictions/`にコピー
  - **対策**: 今後は統計再計算時に必ず両方を更新する

#### 3. 実装済みの機能
- [x] 3モデル（standard, safeBet, upsetFocus）の統計計算
  - [x] モデルごとの的中率・回収率を分離計算
  - [x] 単勝・複勝・3連複・3連単の全4券種に対応
  - [x] 日別履歴もモデルごとに保持

- [x] データ構造の将来対応
  - [x] `race.predictions.{modelKey}`形式で複数モデルに対応
  - [x] `race.accuracy.{modelKey}`形式で的中判定を保存
  - [x] 後方互換性も維持（古いデータは`standard`として扱う）

#### 4. 確認された統計データ（2025-12-19時点、15レース）
**safeBet（本命狙い）:**
- 単勝: 的中率53.3%, 回収率134.7%（8的中、払戻2,020円）
- 複勝: 的中率60.0%, 回収率78.0%
- 3連複: 的中率13.3%, 回収率40.7%（2的中、払戻610円）
- 3連単: 的中率6.7%, 回収率62.7%（1的中、払戻940円）
  - 的中レース: 芦屋3R（予想1-3-2 → 結果1-3-2）

**upsetFocus（穴狙い）:**
- 単勝: 的中率26.7%, 回収率94.0%（4的中、払戻1,410円）
- 複勝: 的中率46.7%, 回収率92.7%
- 3連複: 的中率6.7%, 回収率332.7%（1的中、高配当）
- 3連単: 的中率0.0%, 回収率0.0%

**standard（スタンダード）:**
- 単勝: 的中率26.8%, 回収率71.8%（2,043レース）
- 複勝: 的中率49.6%, 回収率85.1%
- 3連複: 的中率12.9%, 回収率79.3%
- 3連単: 的中率2.8%, 回収率135.8%

---

### UI/UX改善（2025-12-19完了）

#### ページタイトルとタブ名の改善
- [x] タブ名を分かりやすく変更
  - 「的中レース」タブ: 的中したレースの一覧を表示
  - 「成績」タブ: 的中率・回収率の統計データを表示
  - タブ名をシンプルで直感的な名称に統一

- [x] 本日の日付を追加
  - 「今日のレース 12/19(木)」形式で表示
  - 「🏁 本日開催中のレース 12/19(木)」
  - 成績ページに「2025年12月19日（木）」を追加
  - M/D(曜日)形式でコンパクトに表示

- [x] AccuracyDashboardのページタイトルを変更
  - 「📊 AI予想的中率」→「📊 成績」
  - ページ内容と統一された名称に

- [x] 回収率推移グラフを改善
  - 表示期間を直近14日→直近7日に変更
  - タイトル: 「📈 回収率推移（直近7日）」
  - グラフの視認性が向上

- [x] 的中レースページのUI改善（2025-12-19完了）
  - HitRaces.jsxの全インラインスタイルをCSSクラスに移行
  - AccuracyDashboard.jsxと同じスタイル体系に統一
  - HitRaces.cssを新規作成（440行）
  - 順位表示の色問題を修正（背景色とのコントラスト改善）
  - モデル選択タブ、期間選択タブ、統計テーブル、レースカードを全てCSSクラス化
  - レスポンシブデザイン対応（モバイル、タブレット）
  - コードの保守性と可読性を向上

---

### 収益化・ドメイン設定（2025-12-12完了）
- [x] サービス名を「BoatAI」に変更
  - [x] index.html（title、meta description）
  - [x] package.json
  - [x] README.md
  - [x] src/App.jsx（ヘッダー、フッター）
- [x] boat-ai.jpドメインを取得（お名前.com）
- [x] Vercelでカスタムドメイン設定
- [x] お名前.comでDNS設定
  - [x] A Record: @ → 216.198.79.1
  - [x] CNAME Record: www → vercel-dns

### デプロイ環境の最適化（2025-12-12完了）
- [x] Vercelへの一本化
  - [x] vite.config.jsのbaseパスを'/'に変更
  - [x] GitHub Pagesワークフローを無効化
- [x] データファイル問題の解決
  - [x] data/をpublic/data/にコピー
  - [x] スクレイピングワークフローを更新（自動同期）
  - [x] Vercelビルドにデータファイルが含まれることを確認
  - [x] 回収率が正常に表示されることを確認

### Google Cloud連携（2025-12-12完了）
- [x] Googleフォーム作成とContact.jsxへの埋め込み
  - [x] Googleフォームを作成
  - [x] フォームのURLを取得
  - [x] `src/components/Contact.jsx` にiframeを埋め込む
- [x] Google Cloud Project設定
  - [x] Google Cloud Consoleでプロジェクト作成（boatrace-ai-predictor）
  - [x] Google Sheets APIを有効化
  - [x] サービスアカウント作成（boatrace-sheets-updater）
  - [x] サービスアカウントキー（JSON）をダウンロード
- [x] Googleスプレッドシート作成・共有設定
  - [x] 新規スプレッドシートを作成
  - [x] シート名を「AI予想実績」に変更
  - [x] スプレッドシートIDを取得
  - [x] サービスアカウントと共有（編集権限）
- [x] GitHub Secrets設定（Google Sheets）
  - [x] `GOOGLE_SERVICE_ACCOUNT_KEY` を追加
  - [x] `GOOGLE_SPREADSHEET_ID` を追加
- [x] Google Sheets動作確認
  - [x] ローカルでテスト実行成功
  - [x] GitHub Actionsで自動実行成功

### バグ修正（2025-12-12完了）
- [x] 複勝ロジックの修正
  - [x] README.mdの定義修正（3位以内 → 2位以内）
  - [x] docs/recovery-rate-design.mdの修正
  - [x] docs/implementation-plan.mdの修正
  - [x] src/App.jsxのUI表示ロジック修正（rank3チェックを削除）

### UI機能（以前に完了）
- [x] プライバシーポリシーページ作成（`src/components/PrivacyPolicy.jsx`）
- [x] お問い合わせページ作成（`src/components/Contact.jsx`）
- [x] 的中率統計ページを表形式にリニューアル
  - [x] 「今月」セクションを表形式で表示（単勝/複勝/3連複/3連単の的中率と回収率）
  - [x] 「直近のパフォーマンス」を10列の詳細な表形式に変更（2段ヘッダー構造）
  - [x] 「回収率について」の説明をページ上部に移動
  - [x] 旧「前日の的中率と回収率」テーブルを削除
  - [x] `scripts/calculate-accuracy.js` で今月・先月の回収率を計算
  - [x] `summary.json` を再生成
  - [x] レスポンシブデザイン対応（1024px/768px/480pxブレークポイント）
- [x] 「直近のパフォーマンス」に回収率を追加
  - [x] `scripts/calculate-accuracy.js` を修正
  - [x] `AccuracyDashboard.jsx` に表示実装
- [x] モバイル対応の大幅改善
  - [x] レスポンシブデザインの強化（1024px/768px/480pxブレークポイント）
  - [x] タッチターゲットのサイズ最適化（最小44x44px）
  - [x] フォントサイズの調整（モバイルで読みやすく）
  - [x] テーブルの横スクロール対応
  - [x] 直近のパフォーマンスセクションのモバイルレイアウト改善
  - [x] パディング・マージンの最適化

### 自動化機能（以前に完了）
- [x] Google Sheets連携スクリプト作成（`scripts/update-google-sheets.js`）
- [x] GitHub ActionsでSheets自動更新設定（`.github/workflows/update-google-sheets.yml`）
- [x] メール送信スクリプト作成（`scripts/send-email-notification.js`）
- [x] GitHub Actionsでメール自動送信設定（`.github/workflows/send-email-notification.yml`）

### ドキュメント（以前に完了）
- [x] Google Sheetsセットアップガイド（`docs/google-sheets-setup.md`）
- [x] SendGridセットアップガイド（`docs/sendgrid-setup.md`）
- [x] 統合自動化ガイド（`docs/automation-setup.md`）

---

## 📝 メモ

### 現在のデプロイフロー
```
毎時（GitHub Actions）
  ↓
レースデータ取得 → 予想生成 → 結果取得 → 的中率計算
  ↓
data/ と public/data/ を同期
  ↓
GitHubにコミット
  ↓
Vercelが自動デプロイ（1～2分）
  ↓
https://boat-ai.jp に反映（DNS反映後）
```

### DNS反映状況
- **設定完了**: 2025-12-12 15:30
- **現在の状態**: 反映待ち（2～24時間）
- **確認コマンド**: `nslookup boat-ai.jp 8.8.8.8`
- **正しいIP**: 216.198.79.1

### Vercelプロジェクト情報
- **プロジェクト名**: boatrace-ai-predictor
- **本番URL**: https://boatrace-ai-predictor-21zjyoyck-rhapsody0919s-projects.vercel.app
- **カスタムドメイン**: boat-ai.jp（DNS反映後有効化）
- **ダッシュボード**: https://vercel.com/rhapsody0919s-projects/boatrace-ai-predictor

### Google Cloud情報
- **プロジェクトID**: boatrace-ai-predictor
- **サービスアカウント**: boatrace-sheets-updater@boatrace-ai-predictor.iam.gserviceaccount.com
- **スプレッドシートID**: 13B7LkNjpwau1SNt1vAL9zXFeEuyeFXpRmBzqpzlnDbU

### 無料プランの制限
- **Google Sheets API:** 1日500リクエスト（現在約24回/日使用）→ 問題なし
- **SendGrid:** 1日100通（現在1通/日使用）→ 問題なし
- **GitHub Actions:** パブリックリポジトリは無料
- **Vercel:** 個人プランは無料（帯域100GB/月、ビルド6000分/月）

---

## 💡 将来的な改善案

### SNS自動運用
- Xアカウント運用
  - 毎日の的中率レポート自動投稿
  - 高的中時の自動ツイート
- note 自動投稿運用
  - 週次レポートの自動生成・投稿

### 機能追加
- ユーザー登録・ログイン機能
- マイページ（お気に入りレース、予想履歴）
- プッシュ通知（レース開始前）
- LINE Bot連携

### データ分析強化
- AIモデルの改善（機械学習）
- 過去データからのパターン分析
- 競艇場ごとの傾向分析

## todo
- 解説根拠の充実をしたい
- 更新時間や更新状況を「今日のレース」「的中レース」「成績」のそれぞれのページの上部に表示したい
- 初心者でもわかるように使い方の説明を入れたい
- 🏁 レース結果のセクションの1着2着3着のところとかその下のところとか、スマホだとかなり大きくて無駄にスクロールする必要があるので修正したい
- 不要なファイルが多いと思うので整理したい
  - 既に完了したdocで内容が重複してるものは削除して良い。残すべきものは一箇所にまとめて欲しい
  - システム動作仕様.mdのような有用なdocは残して欲しい
- シェア機能でもどのモデルかわかるようにしてほしい
- SEO対策をしてほしい


---

最終更新: 2025-12-19 19:00
