# ボートレースAI予想サイト - 課題リスト

最終更新: 2025-12-08

---

## 1. 機能面の課題

### 高

**1-1. エラーハンドリングの不足**
- `App.jsx` L59-103: データ取得エラー時、エラーメッセージは表示されるが、リトライ機能がない
- 予想データが見つからない場合（L186-200）、フォールバックロジックが存在するが、実データがない場合ダミーデータを生成している（機能的に意味がない）
- スクリプト側（scrape-results.js）では `continue-on-error: true` が設定されており、エラーが隠蔽される可能性

**1-2. AI予想ロジックの問題**
- `generate-predictions.js` L20-29: AIスコア計算が単純な線形計算のみ
- `App.jsx` L268-275: 同様の単純計算をクライアント側でも実施（重複ロジック）
- 実際の「AI」ではなく、統計値の重み付け合計に過ぎない（誤解を招く可能性）

**1-3. データ同期の課題**
- レース結果の取得が手動トリガーまたは1時間間隔（scrape.yml L7）
- リアルタイム性が低く、レース終了直後の結果確認ができない
- 的中率計算も同様に遅延が発生

### 中

**1-4. 予想データのキャッシュ問題**
- `App.jsx` L142-174: 予想データを毎回fetchしているが、同じレースを複数回クリックした場合もキャッシュしない
- ブラウザキャッシュに依存しているが、明示的な制御がない

**1-5. データの欠損処理**
- `scrape-to-json.js` L166-233: 選手データが取得できない場合、空配列を返すだけ
- UI側での欠損データに対する適切なフィードバックが不足

**1-6. 機能の未実装**
- オッズ情報の取得・表示がない
- 過去のレース履歴閲覧機能がない
- お気に入りレース場の保存機能がない
- プッシュ通知機能がない

### 低

**1-7. パフォーマンス最適化の余地**
- `App.jsx` L230-276: `generatePlayers`や`generateInsights`が毎回再計算される
- React.memoやuseMemoの活用がない

---

## 2. UI/UX面の課題

### 高

**2-1. アクセシビリティの問題**
- `index.html` L3: `lang="en"` が設定されているが、日本語サイト
- アクセシビリティ属性が極めて少ない（全体で27箇所のみ）
- キーボード操作への配慮が不足（レース選択がマウス必須）
- スクリーンリーダー対応が不十分

**2-2. エラー状態の表示**
- `App.jsx` L360-365: エラーメッセージが目立たない（黄色の背景のみ）
- ユーザーがどうすべきか不明確（リロードすべき？待つべき？）

### 中

**2-3. レスポンシブ対応の不完全性**
- `App.css` L744-748: テーブルが横スクロールになるだけで、モバイルでの可読性が低い
- 詳細データ分析テーブル（L773-781）がmin-width: 800pxで、スマホでは見づらい

**2-4. ローディング状態の改善余地**
- `App.jsx` L133-140: AI予想完了後の自動スクロールは便利だが、ユーザーが予期しない動きで混乱する可能性
- ローディング中の進捗状況が不明（何%完了したか分からない）

**2-5. ユーザビリティの問題**
- レース場選択ドロップダウン（L378-400）がレース一覧の上にあり、選択後に下部のレースカードを見る必要がある（視線移動が多い）
- 「本日のレース」と「的中率統計」のタブ切り替えでURLハッシュが変わるが、ブラウザバック時の挙動がやや不自然（※修正済み）

**2-6. デザインの細かい不統一**
- `AccuracyDashboard.css` L202: border-left: 4px vs `App.css` L465: border-left: 5px（統一性なし）
- カラーパレットは定義されているが（App.css L12-29）、一部でハードコードされた色も存在

### 低

**2-7. SEO対策の不足**
- `index.html` L7: titleが「boatrace-ai-predictor」のままで、SEO的に弱い
- meta descriptionがない
- OGPタグがない

**2-8. 多言語対応がない**
- 日本語のみで、国際化への対応がない

---

## 3. 技術面の課題

### 高

**3-1. セキュリティの懸念**
- `.env.local` が存在し、機密情報が含まれる可能性（.gitignoreには含まれているが注意が必要）
- CSP（Content Security Policy）の設定がない
- CORS設定が明示的でない（GitHub Pagesでは問題ないが、他環境では課題）

**3-2. エラーハンドリングの不足**
- try-catchは存在するが、エラー詳細がconsoleにしか出力されない
- エラートラッキング（SentryやBugsnag等）がない
- スクリプト側のエラー（scrape-results.js, calculate-accuracy.js）が `continue-on-error: true` で握りつぶされる

**3-3. コードの品質**
- `App.jsx`: 700行超の巨大なコンポーネント（責務が多すぎる）
- ビジネスロジック（AI予想計算）とプレゼンテーションロジックが混在
- カスタムフックへの分離がない（useRaceData, usePrediction等）

### 中

**3-4. TypeScriptの不使用**
- 全てJavaScriptで記述されており、型安全性がない
- 選手データ構造やAPI responseの型定義がない

**3-5. 状態管理の課題**
- 複雑な状態（多数のuseState）がApp.jsxに集中
- Context APIやZustand等の状態管理ライブラリ未使用

**3-6. テストコードの不在**
- プロジェクト独自のテストファイル（*.test.js, *.spec.js）が存在しない
- package.jsonにtestスクリプトがない
- CI/CDでのテストパイプラインがない

**3-7. パフォーマンス**
- React.memo, useMemo, useCallbackの活用がない
- 全レースデータを一度に読み込むため、開催場数が多い日は重い
- 仮想スクロール（react-window等）の検討余地

### 低

**3-8. 保守性の課題**
- `vite.config.js` L10: コメントで「data/races.json を dist にコピー」とあるが、実際の処理は deploy.yml で行われており、設定ファイルとの乖離
- マジックナンバー（L108: confidence計算の70, 95, 10など）がハードコードされている

**3-9. 依存関係の管理**
- package.json: cheerioがdependenciesに含まれているが、ブラウザでは使わない（scriptsのみで使用）
- devDependenciesとの適切な分離が必要

---

## 4. データ面の課題

### 高

**4-1. データの精度・信頼性**
- スクレイピング失敗時のフォールバック処理が不十分
- `scrape-to-json.js` L166-233: HTMLパース失敗時、nullを返すだけで、部分的なデータ保存もない
- 選手の級別や統計データの取得が失敗した場合、デフォルト値（'-'や0）になり、誤った予想につながる

**4-2. データ更新の仕組み**
- GitHub Actionsのcronが1時間間隔で、レース間隔（通常15-20分）に比べて粗い
- レート制限対策（scrape-to-json.js L361: 1秒待機）があるが、24レース場×12レース分の連続アクセスで制限に引っかかる可能性

### 中

**4-3. データの欠損処理**
- `App.jsx` L239-252: racersがない場合ダミーデータを生成しているが、これはユーザーに誤った情報を提供するリスク
- 「データがありません」と明示すべき

**4-4. データの整合性**
- 予想データ（predictions/*.json）とレース結果（results）の紐付けがraceIdのみで、データ不整合時の検証がない
- summary.jsonの統計計算ロジック（calculate-accuracy.js）で、日付のタイムゾーン処理（L183-185）が複雑でバグの温床

### 低

**4-5. データの永続性**
- 過去データの保存期間が不明確
- summary.jsonのdailyHistoryが直近30日のみ（L248）で、長期分析ができない

---

## 5. その他

### 高

**5-1. ドキュメントの不足**
- README.mdがViteテンプレートのまま
- プロジェクト固有の情報（セットアップ方法、デプロイ手順、スクリプトの実行方法）がない
- API仕様書やデータ構造の説明がない

### 中

**5-2. SEOの課題**
- `index.html`: titleとmeta descriptionが不足
- robots.txtがない
- サイトマップがない
- 構造化データ（JSON-LD）がない

**5-3. 監視・ロギング**
- エラートラッキングツールの導入がない
- アクセス解析（Google Analytics等）の設定がない
- パフォーマンス監視がない

**5-4. CI/CDの改善余地**
- deploy.yml: ビルド前のlintチェックがない
- scrape.yml: スクレイピング失敗時の通知がない（Slack, Discord等）
- テストパイプラインがない

### 低

**5-5. ライセンス**
- LICENSEファイルがない
- スクレイピング対象サイトの利用規約遵守に関する記載がない

**5-6. 環境変数管理**
- `.env.local`が存在するが、`.env.example`がなく、必要な環境変数が不明

---

## 優先度別アクションプラン

### 早急に対応すべき課題（重要度：高）
1. **アクセシビリティの大幅改善**
   - index.htmlのlang属性を"ja"に修正
   - ARIA属性の追加
   - キーボードナビゲーション対応

2. **エラーハンドリングとリトライ機構の実装**
   - データ取得失敗時のリトライ機能
   - エラー状態の明確な表示と復旧方法の案内

3. **コンポーネントの分割と責務の明確化**
   - App.jsxを複数のコンポーネントに分割
   - カスタムフックの作成（useRaceData, usePrediction等）

4. **データ欠損時の適切な処理**
   - ダミーデータ生成の廃止
   - 欠損データの明示的な表示

5. **README等のドキュメント整備**
   - プロジェクト概要の記載
   - セットアップ手順
   - デプロイ手順

6. **セキュリティ設定（CSP等）**
   - Content Security Policyの設定
   - セキュリティヘッダーの追加

### 中期的に検討すべき課題（重要度：中）
1. TypeScriptへの移行
2. テストコードの追加（Jest, React Testing Library）
3. 状態管理ライブラリの導入（Zustand等）
4. パフォーマンス最適化（React.memo, useMemo等）
5. SEO対策の強化（meta tags, OGP等）
6. レスポンシブ対応の改善

### 長期的な改善項目（重要度：低）
1. 多言語対応（i18n）
2. オッズ情報などの追加機能
3. モニタリング・ロギング基盤の構築
4. PWA化（オフライン対応、プッシュ通知）

---

## 総括

このサイトは基本的な機能は動作していますが、プロダクショングレードとして運用するには、特に以下の面で大幅な改善が必要です：

- **アクセシビリティ**: すべてのユーザーが利用できるようにするための基本的な対応が不足
- **エラーハンドリング**: 予期しないエラーへの対処が不十分で、ユーザー体験を損なう可能性
- **コード品質**: 大きなコンポーネント、責務の混在、型安全性の欠如などメンテナンス性に課題
- **ドキュメント**: プロジェクトの理解を助ける文書が不足

これらの課題に優先度をつけて計画的に取り組むことで、より信頼性が高く、使いやすいサービスに成長させることができます。
