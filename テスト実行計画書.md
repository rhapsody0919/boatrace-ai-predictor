# テスト実行計画書

## 1. はじめに（目的）

本テスト実行計画書は、ボートレースAI予測アプリケーションの品質保証を目的として作成されたものです。本アプリケーションは、リアルタイムでボートレースデータを取得し、簡易的な予測機能でレース結果の推奨をユーザーに提供する Web アプリケーションです。

本計画の目指すゴールは以下の通りです：

* アプリケーションの主要機能が仕様通りに動作することを検証する
* 外部API連携の信頼性と異常系の適切なハンドリングを保証する
* ユーザー体験を損なうバグや不具合を事前に検出し、排除する
* リリース後の本番環境でも安定的に動作することを確認する
* 継続的な機能追加やリファクタリングに耐えうるテスト基盤を構築する

## 2. テスト対象範囲

### テスト対象

* **レースデータ取得機能**: 外部API（boatraceopenapi.github.io）からのデータ取得および表示
* **レース予測機能**: 簡易的な予測ロジックによる結果の生成と表示
* **UI/UXコンポーネント**: レース場選択、レース一覧表示、予測結果表示、広告バナー表示
* **データ変換・整形ロジック**: API レスポンスからアプリケーション内部データへの変換処理
* **エラーハンドリング**: ネットワークエラー、APIエラー、データ不整合への対応
* **状態管理**: React の useState/useEffect によるアプリケーション状態の管理
* **Vercel デプロイメント**: ビルドプロセスと静的ホスティング環境での動作

### テスト対象外

* 外部API（boatraceopenapi.github.io）自体の機能や信頼性
* ブラウザ自体のバグや仕様差異（ただし、クロスブラウザ互換性の基本的な確認は行う）
* 広告配信サービス（AdSense等）の機能や表示ロジック
* パフォーマンステスト（大規模負荷試験など）※初期フェーズでは対象外とし、必要に応じて将来的に検討

## 3. テスト戦略とアプローチ

### 3.1 機能テスト

本アプリケーションの主要機能に対して、以下の観点でテストを実施します。

#### レースデータ取得機能

**理由**: 外部APIからのデータ取得は、アプリケーションの根幹をなす機能です。APIの応答遅延、タイムアウト、データ形式の変更などに適切に対応できることが、サービスの安定性に直結します。

**テスト観点**:
* 正常系: APIから正しいJSON形式のデータを取得し、レース情報が適切に表示されること
* 異常系: API接続エラー時に、ユーザーにわかりやすいエラーメッセージが表示されること
* フォールバック: 実データ取得失敗時にサンプルデータが表示されること
* データ変換: API レスポンスのデータが正しくアプリケーション内部形式に変換されること
* 境界値: レース場番号の範囲（1-24）、レース番号（1-12）が正しく処理されること

#### レース予測機能（簡易実装）

**理由**: 予測機能はアプリケーションの付加価値を提供します。本フェーズでは、必要最低限の労力で実装可能な簡易的な予測ロジックを採用し、基本的な動作を検証することを重視します。

**テスト観点**:
* レースデータを入力として受け取り、予測結果（順位推奨など）が返却されること
* 予測結果が適切な形式（JSON、配列など）で返されること
* 予測処理中のローディング状態が適切に表示されること
* エラー発生時に適切なエラーメッセージが表示されること

#### UI/UXコンポーネント

**理由**: ユーザーが実際に操作するインターフェースであり、使いやすさと視覚的な品質がユーザー満足度に直結します。

**テスト観点**:
* レース場選択UIが正しく機能し、選択したレース場のデータが表示されること
* レース一覧が時刻順に並び、視認性の高い形で表示されること
* 予測結果が見やすい形式で表示され、重要な情報が強調表示されること
* レスポンシブデザインが機能し、モバイル・タブレット・PCで適切に表示されること
* 広告バナーが意図した位置に表示され、コンテンツの可読性を損なわないこと

### 3.2 バリデーションテスト

**理由**: 外部APIから受け取るデータは、常に期待通りの形式とは限りません。不正なデータや想定外の値がアプリケーションをクラッシュさせることを防ぐため、入力検証は極めて重要です。

**テスト方針**:
* API レスポンスデータのスキーマ検証（必須フィールドの存在確認、データ型チェック）
* 数値範囲のバリデーション（レース場番号、レース番号、天候データなど）
* null/undefined値の適切なハンドリング
* 予期しないデータ構造への対応（配列が空、オブジェクトが欠損など）
* XSS対策（ユーザー入力がある場合）やデータサニタイズの確認

### 3.3 統合テスト

**理由**: 個々のコンポーネントが正しく動作していても、それらが組み合わさった時に問題が発生することがあります。エンドツーエンドでのデータフローを検証することが必須です。

**テスト観点**:
* ページ読み込みから API データ取得、レース一覧表示までの一連のフロー
* レース選択から予測実行、結果表示までの一連のフロー
* エラー発生時のリトライ、フォールバック、エラー表示までのフロー

## 4. テストレベル

本プロジェクトでは、以下のテストレベルを組み合わせて品質を保証します。

### ユニットテスト

**目的**: 個々の関数やコンポーネントが独立して正しく動作することを検証

**対象**:
* データ変換関数（API レスポンス → アプリケーション内部形式）
* 日時計算ロジック（発走時刻の算出など）
* 簡易予測ロジック（入力受け取り → 結果返却の基本動作）
* ユーティリティ関数（レース場名のマッピング、データフォーマットなど）

**ツール**: Jest + React Testing Library

**方針**: カバレッジ目標 80%以上。ビジネスロジックを含む関数は 100% を目指す。

### APIテスト（統合テスト）

**目的**: 外部APIとの連携が正しく機能することを検証

**対象**:
* boatraceopenapi.github.io API への HTTP リクエスト
* レスポンスデータのパース処理
* エラーハンドリング（ネットワークエラー、タイムアウト、404/500エラーなど）

**ツール**: Jest + MSW（Mock Service Worker）でAPIモックを作成

**方針**: 正常系1パターン、異常系3パターン（ネットワークエラー、APIエラー、不正なデータ）を必須テストケースとする

### E2Eテスト（エンドツーエンドテスト）

**目的**: ユーザーの実際の操作フローをシミュレートし、アプリケーション全体が意図通りに動作することを検証

**対象**:
* ページ読み込み時の初期表示
* レースデータの取得と一覧表示
* レース選択と予測実行
* エラー時のユーザーフィードバック
* 広告バナーの表示

**ツール**: Playwright または Cypress

**方針**: クリティカルパス（レース一覧表示 → 予測実行 → 結果表示）を最優先でテスト。月次でのリグレッションテスト実施。

### テストレベルの組み合わせ方針

* **開発時**: ユニットテストを中心に、TDD（テスト駆動開発）の手法で実装
* **機能完成時**: APIテストで外部連携を検証
* **リリース前**: E2Eテストでユーザーシナリオ全体を検証
* **CI/CD**: GitHub Actions でユニットテスト・APIテストを自動実行。E2Eテストは main ブランチへのマージ時に実行

## 5. テストスケジュールと優先度

### フェーズ1: 基盤構築（優先度：高）
* テスト環境のセットアップ（Jest、React Testing Library、MSW）
* データ変換関数のユニットテスト実装
* APIモック作成とAPIテストの基本構造構築

### フェーズ2: 主要機能テスト（優先度：高）
* レースデータ取得機能のテスト
* 簡易予測機能のテスト
* エラーハンドリングのテスト

### フェーズ3: UI/UXテスト（優先度：中）
* コンポーネントのユニットテスト
* レスポンシブデザインの確認
* E2Eテストのクリティカルパス実装

### フェーズ4: 継続的改善（優先度：中）
* カバレッジの向上
* E2Eテストの拡充
* パフォーマンステストの検討

## 6. 終了基準

以下の条件をすべて満たした場合、テストフェーズを完了とします：

* ユニットテストカバレッジが 80% 以上
* APIテストの正常系・異常系がすべてパス
* E2Eテストのクリティカルパスがすべてパス
* 重大度「高」のバグが0件
* 重大度「中」のバグが残っている場合、対応スケジュールが明確化されている
* テスト結果レポートが作成され、ステークホルダーに共有済み

## 7. リスクと対策

### リスク1: 外部APIの仕様変更
* **対策**: API レスポンスのスキーマ検証を実装し、仕様変更を早期検出。モックデータでのテストを充実させ、API依存を最小化

### リスク2: テスト環境の構築に時間がかかる
* **対策**: 初期段階でテスト環境構築を最優先タスクとし、AI ツールを活用して設定を自動化

### リスク3: E2Eテストの不安定性（flaky tests）
* **対策**: 適切な待機処理（waitFor）を実装。リトライメカニズムを導入し、CI/CD での安定性を確保

---

**文書作成日**: 2025-11-27
**作成者**: テストストラテジスト
**対象プロジェクト**: ボートレースAI予測アプリケーション
**バージョン**: 1.0
